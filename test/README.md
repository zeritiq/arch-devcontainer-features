# DevContainer Features Testing

This directory contains tests for the devcontainer features in this repository.

## Test Structure

```
test/
├── yay/                    # Tests for yay AUR helper feature
│   ├── test.sh            # Basic yay installation test
│   ├── test_with_packages.sh  # Test with package installation
│   └── scenarios.json     # Test scenarios configuration
└── clone-repo/            # Tests for clone-repo feature
    ├── test.sh            # Basic clone script installation test
    ├── test_https_clone.sh    # Test HTTPS repository cloning
    ├── test_branch_clone.sh   # Test branch-specific cloning
    ├── test_default_target.sh # Test default target directory
    └── scenarios.json     # Test scenarios configuration
```

## Running Tests

### Local Testing

To run tests locally, you need the devcontainer CLI:

```bash
# Install devcontainer CLI
npm install -g @devcontainers/cli

# Run all tests
devcontainer features test .

# Run tests for specific feature
devcontainer features test -f yay .
devcontainer features test -f clone-repo .

# Run only autogenerated tests (skip scenarios)
devcontainer features test --skip-scenarios .

# Run only scenario tests
devcontainer features test --skip-autogenerated .
```

### CI/CD Testing

Tests are automatically run via GitHub Actions:

- **On push to main branch**
- **On pull requests**
- **Manual workflow dispatch**

## Test Coverage

### Yay Feature Tests

- **Basic installation**: Verifies yay is installed and functional
- **Package installation**: Tests installing AUR packages
- **Compatibility**: Tests on Arch Linux base images
- **Permissions**: Verifies user permissions for package operations

### Clone-repo Feature Tests

- **Basic functionality**: Verifies git and clone script installation
- **HTTPS cloning**: Tests cloning public repositories via HTTPS
- **Branch cloning**: Tests cloning specific branches
- **Default target**: Tests default workspace directory behavior
- **Arch Linux compatibility**: Tests on Arch Linux base images

## Test Images

### Yay Feature
- `archlinux:latest` - Primary test image
- `archlinux:base` - Minimal Arch Linux image

### Clone-repo Feature
- `archlinux:latest` - Primary test image
- `archlinux:base` - Minimal Arch Linux image

## Test Scenarios

Test scenarios are defined in `scenarios.json` files and include:

- Different feature option combinations
- Various base images
- Specific use cases and edge cases

## Troubleshooting

If tests fail:

1. **Check base image compatibility**: Ensure the feature supports the test image
2. **Verify network access**: Some tests require internet connectivity
3. **Check permissions**: Ensure proper user permissions in test containers
4. **Review logs**: Check GitHub Actions logs for detailed error information

## Adding New Tests

To add tests for a new feature:

1. Create `test/<feature-name>/` directory
2. Add `test.sh` for basic functionality tests
3. Add additional test files for specific scenarios
4. Create `scenarios.json` for complex test configurations
5. Update `.github/workflows/test.yaml` to include the new feature
6. Make test scripts executable: `chmod +x test/<feature-name>/*.sh`
