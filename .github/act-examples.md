# Локальное тестирование с Act

Этот файл содержит примеры использования [act](https://github.com/nektos/act) для локального тестирования GitHub Actions workflows.

## Установка act

```bash
# macOS
brew install act

# Linux
curl https://raw.githubusercontent.com/nektos/act/master/install.sh | sudo bash

# Windows (через Chocolatey)
choco install act-cli
```

## Примеры использования

### 1. Тестирование всех features (по умолчанию)

```bash
# Запустить все тесты
act workflow_dispatch

# Запустить только autogenerated тесты
act workflow_dispatch -j test-autogenerated

# Запустить только scenario тесты
act workflow_dispatch -j test-scenarios
```

### 2. Тестирование конкретного feature

```bash
# Тестировать только yay feature
act workflow_dispatch --input features=yay

# Тестировать только clone-repo feature
act workflow_dispatch --input features=clone-repo
```

### 3. Тестирование нескольких features

```bash
# Тестировать yay и clone-repo
act workflow_dispatch --input features=yay,clone-repo
```

### 4. Тестирование с конкретными базовыми образами

```bash
# Тестировать только на archlinux:latest
act workflow_dispatch --input base_images=archlinux:latest

# Тестировать на нескольких образах
act workflow_dispatch --input base_images=archlinux:latest,archlinux:base
```

### 5. Комбинированное тестирование

```bash
# Тестировать только yay на archlinux:latest
act workflow_dispatch --input features=yay --input base_images=archlinux:latest

# Тестировать clone-repo на archlinux:base
act workflow_dispatch --input features=clone-repo --input base_images=archlinux:base
```

### 6. Тестирование pull request событий

```bash
# Симулировать PR (будет тестировать все features)
act pull_request
```

### 7. Тестирование push событий

```bash
# Симулировать push в main ветку
act push
```

## Полезные флаги act

```bash
# Показать только список jobs без выполнения
act workflow_dispatch --list

# Запустить с verbose логированием
act workflow_dispatch --verbose

# Использовать конкретный Docker образ для runner
act workflow_dispatch --platform ubuntu-latest=catthehacker/ubuntu:act-latest

# Запустить в dry-run режиме
act workflow_dispatch --dry-run

# Переиспользовать контейнеры (быстрее для повторных запусков)
act workflow_dispatch --reuse
```

## Примеры для разработки

### Быстрое тестирование изменений в yay feature

```bash
# Тестировать только yay на одном образе
act workflow_dispatch \
  --input features=yay \
  --input base_images=archlinux:latest \
  --reuse
```

### Тестирование новых изменений в clone-repo

```bash
# Тестировать clone-repo scenarios
act workflow_dispatch \
  --input features=clone-repo \
  -j test-scenarios \
  --reuse
```

### Полное тестирование перед коммитом

```bash
# Запустить все тесты как в CI
act workflow_dispatch --reuse
```

## Конфигурация act

Создайте файл `.actrc` в корне проекта для настройки по умолчанию:

```bash
# .actrc
--platform ubuntu-latest=catthehacker/ubuntu:act-latest
--reuse
--verbose
```

## Troubleshooting

### Проблемы с Docker

```bash
# Если act не может найти Docker
export DOCKER_HOST=unix:///var/run/docker.sock

# Очистить act кэш
act --rm
```

### Проблемы с правами доступа

```bash
# Запустить с sudo если нужно
sudo act workflow_dispatch --input features=yay
```

### Проблемы с сетью в контейнерах

```bash
# Использовать host сеть
act workflow_dispatch --network host
```

## Мониторинг выполнения

```bash
# Следить за логами в реальном времени
act workflow_dispatch --verbose | tee act-run.log

# Анализировать только ошибки
act workflow_dispatch 2>&1 | grep -i error
